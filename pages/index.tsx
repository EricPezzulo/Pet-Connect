import { gql, useQuery } from "@apollo/client";
import type { NextPage } from "next";
import { useSession, signIn, signOut } from "next-auth/react";
import Head from "next/head";
import Image from "next/image";

const FETCH_ALL_ANIMALS = gql`
  query {
    fetchAllAnimals {
      id
      name
      weight
      species
      color
      gender
      dob
      imageUrl
      breed
    }
  }
`;

const Home: NextPage = () => {
  const { data: session } = useSession();
  console.log(session);
  const { data, loading, error } = useQuery(FETCH_ALL_ANIMALS);

  if (loading) return <p>loading</p>;
  if (error)
    return (
      <div>
        <p>ooops there is a problem</p> <p>{error.message}</p>
      </div>
    );
  console.log(data?.fetchAllAnimals);
  const animals = data?.fetchAllAnimals;
  return (
    <div className="flex flex-col min-h-screen bg-gray-50">
      <Head>
        <title>Animal Shelter</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <div className="container flex flex-col mx-auto my-10">
        <h1 className="text-3xl font-medium">Pet Connect</h1>

        <div>
          {!session ? (
            <div>
              <button
                className=" bg-blue-600 rounded px-2 py-1 text-white"
                onClick={() => signIn()}
              >
                Sign In
              </button>
            </div>
          ) : (
            <div className="flex items-center">
              <div>
                <Image
                  src={`${session?.user.image}`}
                  alt={`${session?.user.name}`}
                  width={45}
                  height={45}
                  className="rounded-full"
                />
              </div>{" "}
              <p className="mx-2">Hi, {session?.user.name}</p>
              <div>
                <button
                  className=" flex bg-blue-600 rounded px-2 py-1 text-white"
                  onClick={() => signOut()}
                >
                  Sign Out
                </button>
              </div>
            </div>
          )}
        </div>
        <div>
          {animals &&
            animals.map((animal: any) => (
              <div className="flex flex-col bg-purple-50 max-w-md my-2 shadow rounded h-auto">
                <div className="flex w-full justify-center object-cover">
                  <Image
                    src={animal.imageUrl}
                    alt={`${animal.name}`}
                    width={400}
                    height={350}
                    className="object-contain"
                  />
                </div>
                <div className="flex flex-col p-2">
                  <p>{animal.species}</p>
                  <p>{animal.name}</p>
                  <p>{animal.dob}</p>
                  <p>{animal.weight} lbs</p>
                  <p>Color: {animal.color}</p>
                  <p>Breed: {animal.breed}</p>
                </div>
              </div>
            ))}
        </div>
      </div>
    </div>
  );
};

export default Home;
